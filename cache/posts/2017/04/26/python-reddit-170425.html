<p><html>
  <body>
    <p>
      Hello World!<br>
      Today we are going to take a look at how to create a simple Markov chain generator, by using markovify.<br>
    </p>
    <p>
      Let's get two ebooks from <a href="http://www.gutenberg.org">Project Gutenberg</a>.
      For this tutorial we are going to use <a href="http://www.gutenberg.org/ebooks/11">Alice in Wonderland</a> and <a href="http://www.gutenberg.org/ebooks/2591">Grimms' Fairy Tales</a>, you can download them as a UTF-8 txt.
    </p>
    <p>
      Your project folder will be like this:
      <img class="alignnone size-full wp-image-404" src="/2017/04/mark_tree.png" alt="Folder Tree" width="155" height="117">
    </p>
    <p>
      Let's start coding!
      <pre>
        <code class="py">import nltk
# Let's declare a function to get word index
def get_index(in_list,in_string):
    for num,row in enumerate(in_list):
        if in_string in row:
            return num
# We convert the script from the NLTK Stopwords tutorial into a def
def clean_book(path):
    # Let's open the book we downloaded
    book = open(path,'r').read()
    # Divide text by rows
    rows = book.split('\n')
    # Search for START and END tags to remove useless parts
    start_idx = get_index(rows,'*** START')
    end_idx = get_index(rows,'*** END')
    rows = rows[start_idx+1:end_idx]
    # We need to create a string for markovify
    text = '\n'.join([r for r in rows if r!=''])
    return text</code>
      </pre>
      We are going to use some of the code we wrote in the last <a href="https://inzaniak.github.io/pybistuffblog/posts/2017/04/20/python-count-frequencies-with-nltk.html">tutorial</a>.<br>
      Let's create two functions:
      <ul>
        <li><span style="color: #D4F4DD;"><strong>get_index()</strong></span>: Useful for getting the index of START and END</li>
        <li><span style="color: #D4F4DD;"><strong>clean_book()</strong></span>: Returns the book text without the parts added by Project Gutenberg</li>
      </ul>
    </p>
    <p>
      <pre>
        <code>import markovify
# 1. Build the model.
ebook_a = clean_book('data/ebook.txt')
text_model_a = markovify.Text(ebook_a)
# 2. Print five randomly-generated sentences
for i in range(5):
    print(text_model_a.make_sentence())
# 3. Print three randomly-generated sentences of no more than 140 characters
for i in range(3):
    print(text_model_a.make_short_sentence(140))</code>
      </pre>
    </p>
      <p>Markovify is a really easy-to-use library. After importing we just need to create the model and we can start using it.<br />The steps are:</p>
        <ol>
          <li>We build the model by using <span style="color: #d4f4dd;"><strong>markovify.Text()</strong></span>. The input MUST be a string.</li>
          <li>Then we can print sentences using the model we generated by calling <span style="color: #d4f4dd;"><strong>text_model_a.make_sentence()</strong></span></li>
          <li>We can also make a short sentence using&nbsp;<span style="color: #d4f4dd;"><strong>text_model_a.make_short_sentence(max_length_of_sentence)</strong></span></li>
        </ol>
    </p>
    <p>
      <pre>
        <code># Recreate the model using 3 sentences
three_model = markovify.Text(ebook_a,state_size=3)
for i in range(5):
    print(three_model.make_sentence())</code>
      </pre>We can also use more than 2 sentences to create markov chains by using the state_size variable.
      </p>
      <p>
        <pre>
          <code># Build the second model.
ebook_b = clean_book('data/ebook2.txt')
text_model_b = markovify.Text(ebook_b)
for i in range(5):
    print(text_model_b.make_sentence())<br>
# Combine the models into a single one
both_models = markovify.combine([text_model_a,text_model_b])
for i in range(5):
    print(both_models.make_sentence())</code>
        </pre>
        We can also build a second model and combine it with the first.<br>
        Here are some sentences generated by the combined model:
        <ul>
          <em>
          <li>When evening came, and it was very melancholy, and wandered up and rubbed its eyes: then it watched the geese on.</li>
          <li>‘Well, then,’ the Gryphon only answered ‘Come on!’ cried the cat had a beautiful girl stood like a mountain.</li>
          <li>‘Yes, dear father, your will shall be in a hurry.</li>
          <li>Then poor Snowdrop wandered along through the wood belonged was hunting in it, and shut his eyes, and died.</li>
          <li>The poor horse was the enemy’s commander-in-chief.</li>
        </em>
        </ul>
        </p>
  That's all for today! You can get the code of this post <a href="https://github.com/Inzaniak/pybistuff/tree/master/Markov">here</a>.
  </body>
</html></p>