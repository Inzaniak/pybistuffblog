<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Python: Clean SQL views for documentation | Py, BI and Stuff</title>
<link href="../../../../assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../rss.xml">
<link rel="canonical" href="https://inzaniak.github.io/pybistuffblog/posts/2017/02/07/python-clean-sql-views-for-documentation.html">
<!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><!-- Syntax highlight --><link rel="stylesheet" href="../../../../syntax/styles/zenburn.css">
<script src="../../../../syntax/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><!-- Syntax highlight --><!-- Google Analytics --><script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-90742675-2', 'auto');
ga('send', 'pageview');
</script><script async src="https://www.google-analytics.com/analytics.js"></script><!-- End Google Analytics --><meta name="author" content="Umberto Grando">
<link rel="prev" href="../02/excel-format-cleaner-macro.html" title="Excel: Format Cleaner Macro" type="text/html">
<link rel="next" href="../../03/16/python-get-method.html" title="Python: .get() method" type="text/html">
<meta property="og:site_name" content="Py, BI and Stuff">
<meta property="og:title" content="Python: Clean SQL views for documentation">
<meta property="og:url" content="https://inzaniak.github.io/pybistuffblog/posts/2017/02/07/python-clean-sql-views-for-documentation.html">
<meta property="og:description" content="One of the most tedious tasks of working with databases is to write and maintain documentation, in particular writing reports from tables and views.
So why not try to make this task a bit less heavy b">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-02-07T17:47:19Z">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Senza categoria">
<meta property="article:tag" content="SQL">
<link href="https://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
            <p>A website about <strong>Python</strong>, <strong>Business Intelligence</strong> and<strong> Data Science</strong>. Powered by Python framework <strong>Nikola</strong>.</p>
        </div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../../../archive.html">Archives</a>
        <a class="sidebar-nav-item" href="../../../../categories/index.html">Tags</a>
        <a class="sidebar-nav-item" href="../../../../rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="https://inzaniak.github.io/pybistuffblog/" title="Py, BI and Stuff" rel="home">Py, BI and Stuff</a>
    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="post-title p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Python: Clean SQL views for documentation</a></h1>
    <a href="https://twitter.com/share" class="twitter-share-button" data-show-count="false">Tweet</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Umberto Grando</span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="post-date published dt-published" datetime="2017-02-07T17:47:19+00:00" itemprop="datePublished" title="2017-02-07 17:47">2017-02-07 17:47</time></a></p>
                <p class="commentline">
        
    <a href="python-clean-sql-views-for-documentation.html#disqus_thread" data-disqus-identifier="cache/posts/2017/02/07/python-clean-sql-views-for-documentation.html">Comments</a>


        </p>
</div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p></p>
<p>One of the most tedious tasks of working with databases is to write and maintain documentation, in particular writing reports from tables and views.</p>
<p>So why not try to make this task a bit less heavy by using Python?
</p>
<h6>Step0-The input and the output</h6>
The script requires that the views are created using create view.
Example:
<h6>Right click on view</h6>
<img class="alignnone  wp-image-107" src="../../../../2017/02/img1.png" alt="img1" width="477" height="298"><h6>Copy view</h6>
<img class="alignnone size-full wp-image-110" src="../../../../2017/02/img2.png" alt="img2" width="440" height="237"><h6>Output view after python script</h6>
<img class="alignnone size-full wp-image-121" src="../../../../2017/02/img3.png" alt="img3" width="424" height="224"><hr>
<h6>Step1 - Extract Columns Function</h6>

<pre style="background:#272822;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;margin:0;line-height:125%;"><span style="color:#66d9ef;">def</span> <span style="color:#a6e22e;">extract_columns</span><span style="color:#f8f8f2;">(in_txt):</span>
    <span style="color:#e6db74;">"""Simple function to extract columns between select and from"""</span>
    <span style="color:#75715e;"># Splitting by select i only choose text after select</span>
    <span style="color:#f8f8f2;">out_view</span> <span style="color:#f92672;">=</span> <span style="color:#f8f8f2;">re</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">split(</span><span style="color:#e6db74;">r'(?i)\bselect\b'</span><span style="color:#f8f8f2;">,in_txt)[</span><span style="color:#ae81ff;">1</span><span style="color:#f8f8f2;">]</span>
    <span style="color:#75715e;"># Splitting by from i only choose text before from</span>
    <span style="color:#f8f8f2;">out_view</span> <span style="color:#f92672;">=</span> <span style="color:#f8f8f2;">re</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">split(</span><span style="color:#e6db74;">r'(?i)\bfrom\b'</span><span style="color:#f8f8f2;">,out_view)[</span><span style="color:#ae81ff;">0</span><span style="color:#f8f8f2;">]</span>
    <span style="color:#75715e;"># Cleaning extra spaces and tabs</span>
    <span style="color:#f8f8f2;">out_view</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">strip()</span>
    <span style="color:#66d9ef;">return</span> <span style="color:#f8f8f2;">out_view</span>
</pre>

<p>Let's start by defining a function with the purpose of extracting only the columns from the script of a view. Thus ignoring everything before the Select statement and everything after the From statement.</p>
<hr>
<h6>Step2 -Let's start from the variables</h6>

<pre style="background:#272822;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;margin:0;line-height:125%;"><span style="color:#f92672;">import</span> <span style="color:#f8f8f2;">re</span>

<span style="color:#75715e;"># We open the file containing the view</span>
<span style="color:#f8f8f2;">view</span> <span style="color:#f92672;">=</span> <span style="color:#f8f8f2;">extract_columns(open(</span><span style="color:#e6db74;">'input.txt'</span><span style="color:#f8f8f2;">,</span><span style="color:#e6db74;">'r'</span><span style="color:#f8f8f2;">,encoding</span><span style="color:#f92672;">=</span><span style="color:#e6db74;">'utf-8'</span><span style="color:#f8f8f2;">)</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">read())</span>
<span style="color:#75715e;"># Now we insert text into the list and we create a new list</span>
<span style="color:#f8f8f2;">view_l</span> <span style="color:#f92672;">=</span> <span style="color:#f8f8f2;">view</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">split(</span><span style="color:#e6db74;">'</span><span style="color:#ae81ff;">\n</span><span style="color:#e6db74;">'</span><span style="color:#f8f8f2;">)</span>
<span style="color:#f8f8f2;">out_l</span> <span style="color:#f92672;">=</span> <span style="color:#f8f8f2;">[]</span>
</pre>

<p>Now we declare the variables we are going to use.
</p>
<ul>
<li>view: contains the input text</li>
    <li>view_l: is a list created by splitting text by line</li>
    <li>out_l: is the output list</li>
</ul>
<hr>
<h6>Step3-Main Code</h6>

<pre style="background:#272822;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;margin:0;line-height:125%;"><span style="color:#75715e;"># Now we loop through all the lines of the view</span>
<span style="color:#66d9ef;">for</span> <span style="color:#f8f8f2;">num,line</span> <span style="color:#f92672;">in</span> <span style="color:#f8f8f2;">enumerate(view_l):</span>
    <span style="color:#75715e;"># Clean extra spaces</span>
    <span style="color:#f8f8f2;">line</span> <span style="color:#f92672;">=</span> <span style="color:#f8f8f2;">line</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">strip()</span>
    <span style="color:#75715e;"># Remove Comments</span>
    <span style="color:#f8f8f2;">line</span> <span style="color:#f92672;">=</span> <span style="color:#f8f8f2;">line</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">split(</span><span style="color:#e6db74;">'--'</span><span style="color:#f8f8f2;">)[</span><span style="color:#ae81ff;">0</span><span style="color:#f8f8f2;">]</span>
    <span style="color:#75715e;"># Remove Commas</span>
    <span style="color:#f8f8f2;">line</span> <span style="color:#f92672;">=</span> <span style="color:#f8f8f2;">line</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">replace(</span><span style="color:#e6db74;">','</span><span style="color:#f8f8f2;">,</span><span style="color:#e6db74;">''<span style="color:#ffffff;">,</span>1</span><span style="color:#f8f8f2;">)</span>
    <span style="color:#75715e;"># Substitute Tabs with Spaces</span>
    <span style="color:#f8f8f2;">line</span> <span style="color:#f92672;">=</span> <span style="color:#f8f8f2;">line</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">replace(</span><span style="color:#e6db74;">'</span><span style="color:#ae81ff;">\t</span><span style="color:#e6db74;">'</span><span style="color:#f8f8f2;">,</span><span style="color:#e6db74;">' '</span><span style="color:#f8f8f2;">)</span>
    <span style="color:#75715e;"># While two spaces are in line we substitute the with one space</span>
    <span style="color:#66d9ef;">while</span> <span style="color:#e6db74;">'  '</span> <span style="color:#f92672;">in</span> <span style="color:#f8f8f2;">line:</span>
        <span style="color:#f8f8f2;">line</span> <span style="color:#f92672;">=</span> <span style="color:#f8f8f2;">line</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">replace(</span><span style="color:#e6db74;">'  '</span><span style="color:#f8f8f2;">,</span><span style="color:#e6db74;">' '</span><span style="color:#f8f8f2;">)</span>
    <span style="color:#75715e;"># Remove [ and ]</span>
    <span style="color:#f8f8f2;">line</span> <span style="color:#f92672;">=</span> <span style="color:#f8f8f2;">line</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">replace</span> <span style="color:#f8f8f2;">(</span><span style="color:#e6db74;">'['</span><span style="color:#f8f8f2;">,</span><span style="color:#e6db74;">''</span><span style="color:#f8f8f2;">)</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">replace(</span><span style="color:#e6db74;">']'</span><span style="color:#f8f8f2;">,</span><span style="color:#e6db74;">''</span><span style="color:#f8f8f2;">)</span>
    <span style="color:#75715e;"># If line is not empty</span>
    <span style="color:#66d9ef;">if</span> <span style="color:#f8f8f2;">len(line)</span><span style="color:#f92672;">&gt;</span><span style="color:#ae81ff;">0</span><span style="color:#f8f8f2;">:</span>
        <span style="color:#75715e;"># If line is not a comment</span>
        <span style="color:#66d9ef;">if</span> <span style="color:#f8f8f2;">line[</span><span style="color:#ae81ff;">0</span><span style="color:#f8f8f2;">]</span><span style="color:#f92672;">!=</span><span style="color:#e6db74;">'-'</span><span style="color:#f8f8f2;">:</span>
            <span style="color:#75715e;"># We add the new line to out_l</span>
            <span style="color:#f8f8f2;">out_l</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">append(re</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">split(</span><span style="color:#e6db74;">r'(?i)\bas\b'</span><span style="color:#f8f8f2;">,line))</span>
</pre>

<p>Finally we come to the main code.
The first part is a For loop, using the list we created in step2.
For each line the script removes useless characters and comments and then adds the line to the new list.</p>
<hr>
<h6>Step4-Output Text</h6>

<pre style="background:#272822;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;margin:0;line-height:125%;"><span style="color:#75715e;"># Open output file</span>
<span style="color:#66d9ef;">with</span> <span style="color:#f8f8f2;">open(</span><span style="color:#e6db74;">'out.txt'</span><span style="color:#f8f8f2;">,</span><span style="color:#e6db74;">'w'</span><span style="color:#f8f8f2;">)</span> <span style="color:#66d9ef;">as</span> <span style="color:#f8f8f2;">out_txt:</span>
    <span style="color:#75715e;"># For line in output list</span>
    <span style="color:#66d9ef;">for</span> <span style="color:#f8f8f2;">line</span> <span style="color:#f92672;">in</span> <span style="color:#f8f8f2;">out_l:</span>
        <span style="color:#75715e;"># Try / Except to output all the values to the file separated by ','</span>
        <span style="color:#66d9ef;">print</span><span style="color:#f8f8f2;">(line)</span>
        <span style="color:#66d9ef;">if</span> <span style="color:#f8f8f2;">len(line)</span><span style="color:#f92672;">&gt;</span><span style="color:#ae81ff;">1</span><span style="color:#f8f8f2;">:</span>
            <span style="color:#f8f8f2;">out_txt</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">write(</span><span style="color:#e6db74;">'as'</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">join(line[</span><span style="color:#ae81ff;">0</span><span style="color:#f8f8f2;">:</span><span style="color:#f92672;">-</span><span style="color:#ae81ff;">1</span><span style="color:#f8f8f2;">])</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">strip()</span><span style="color:#f92672;">+</span><span style="color:#e6db74;">'|'</span><span style="color:#f92672;">+</span><span style="color:#f8f8f2;">str(line[</span><span style="color:#f92672;">-</span><span style="color:#ae81ff;">1</span><span style="color:#f8f8f2;">])</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">strip()</span><span style="color:#f92672;">+</span><span style="color:#e6db74;">'</span><span style="color:#ae81ff;">\n</span><span style="color:#e6db74;">'</span><span style="color:#f8f8f2;">)</span>
        <span style="color:#66d9ef;">else</span><span style="color:#f8f8f2;">:</span>
            <span style="color:#f8f8f2;">out_txt</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">write(str(line[</span><span style="color:#ae81ff;">0</span><span style="color:#f8f8f2;">])</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">strip()</span><span style="color:#f92672;">+</span><span style="color:#e6db74;">'|'</span><span style="color:#f92672;">+</span><span style="color:#f8f8f2;">str(line[</span><span style="color:#ae81ff;">0</span><span style="color:#f8f8f2;">])</span><span style="color:#f92672;">.</span><span style="color:#f8f8f2;">strip()</span><span style="color:#f92672;">+</span><span style="color:#e6db74;">'</span><span style="color:#ae81ff;">\n</span><span style="color:#e6db74;">'</span><span style="color:#f8f8f2;">)</span>
</pre>

<p>In the last part we write to an external file using a Try/Except to avoid IndexErrors.</p>
<p>This article is also available on <a href="https://powerbloggerbi.com">PowerBloggerBI</a></p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../categories/python.html" rel="tag">Python</a></li>
            <li><a class="tag p-category" href="../../../../categories/senza-categoria.html" rel="tag">Senza categoria</a></li>
            <li><a class="tag p-category" href="../../../../categories/sql.html" rel="tag">SQL</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../02/excel-format-cleaner-macro.html" rel="prev" title="Excel: Format Cleaner Macro">Previous post</a>
            </li>
            <li class="next">
                <a href="../../03/16/python-get-method.html" rel="next" title="Python: .get() method">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="pybistuff",
            disqus_url="https://inzaniak.github.io/pybistuffblog/posts/2017/02/07/python-clean-sql-views-for-documentation.html",
        disqus_title="Python: Clean SQL views for documentation",
        disqus_identifier="cache/posts/2017/02/07/python-clean-sql-views-for-documentation.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="pybistuff";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><a href="https://twitter.com/share" class="twitter-share-button" data-show-count="false">Tweet</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><footer id="footer"><p>Contents © 2017         <a href="mailto:inzaniak@gmail.com">Umberto Grando</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
    
    
            <script src="../../../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
